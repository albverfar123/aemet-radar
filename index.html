<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8" />
<title>Visor precipitaciÃ³</title>

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
  html, body, #map {
    height: 100%;
    margin: 0;
  }

  .control {
    position: absolute;
    top: 10px;
    right: 10px;
    background: white;
    padding: 12px;
    z-index: 1000;
    border-radius: 8px;
    font-size: 13px;
  }

  .legend-box {
    background: white;
    padding: 10px;
    border-radius: 8px;
    font-size: 12px;
  }

  input[type="date"] {
    width: 160px;
  }

  .status {
    font-size: 11px;
    margin-top: 6px;
    color: #444;
  }
</style>

</head>

<body>

<div id="map"></div>

<div class="control">
  <div><b>Data:</b></div>
  <input id="datePicker" type="date">
  <div class="status" id="statusMsg"></div>

  <br>
  Opacitat:<br>
  <input id="opacitySlider" type="range" min="0" max="1" step="0.05" value="0.7">
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

// =============================
// CONFIGURACIÃ“
// =============================

// ðŸ”´ EDITA AQUESTS ANYS SI CAL
const MIN_DATE = "2026-01-01";
const MAX_DATE = "2026-12-31";

// bounding box (el teu)
const imageBounds = [
  [40.001230899999996, -0.001548599999999567],
  [43.1012309, 3.4984513999999995]
];

// =============================
// MAPA BASE
// =============================
var map = L.map('map').setView([41.5, 1.5], 7);

L.tileLayer(
  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
  { maxZoom: 19 }
).addTo(map);

map.fitBounds(imageBounds);

// =============================
// SELECTOR DATA
// =============================
const datePicker = document.getElementById("datePicker");
const statusMsg = document.getElementById("statusMsg");

datePicker.min = MIN_DATE;
datePicker.max = MAX_DATE;

// per defecte: avui
const today = new Date().toISOString().slice(0,10);
datePicker.value = today;

// =============================
// OVERLAY
// =============================
var overlay = null;

function formatDateToYYYYMMDD(dateStr) {
  return dateStr.replaceAll("-", "");
}

function loadDate(dateStr) {

  if (!dateStr) return;

  const yyyymmdd = formatDateToYYYYMMDD(dateStr);
  const pngPath = "png/GLD_RNN24H_" + yyyymmdd + ".png";

  statusMsg.textContent = "Carregantâ€¦";

  const img = new Image();

  img.onload = function () {

    if (overlay) {
      map.removeLayer(overlay);
    }

    overlay = L.imageOverlay(
      pngPath,
      imageBounds,
      { opacity: document.getElementById("opacitySlider").value }
    ).addTo(map);

    statusMsg.textContent = "âœ” Dades disponibles";
  };

  img.onerror = function () {
    statusMsg.textContent = "âœ– No hi ha dades per aquest dia";
  };

  img.src = pngPath;
}

// carregar inicial
loadDate(datePicker.value);

// =============================
// CANVI DATA
// =============================
datePicker.addEventListener("change", function(e) {
  loadDate(e.target.value);
});

// =============================
// SLIDER OPACITAT
// =============================
document
  .getElementById('opacitySlider')
  .addEventListener('input', function (e) {
    if (overlay) overlay.setOpacity(e.target.value);
  });

// =============================
// LLEGENDA
// =============================
var legend = L.control({ position: "bottomright" });

legend.onAdd = function () {
  var div = L.DomUtil.create("div", "legend-box");

  div.innerHTML = `
    <b>PrecipitaciÃ³ (mm)</b><br>
    <img src="colorbar.png" width="200">
  `;

  return div;
};

legend.addTo(map);

</script>

</body>
</html>



